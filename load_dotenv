import os
import logging
import asyncio
from dotenv import load_dotenv # –î–æ–±–∞–≤–ª—è–µ–º —ç—Ç–æ
from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import Command

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env
load_dotenv()

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

# –ë–µ—Ä–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
TOKEN = os.getenv("BOT_TOKEN")

if not TOKEN:
    logger.critical("‚ùå –û—à–∏–±–∫–∞: –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ñ–∞–π–ª–µ .env!")
    exit(1)

bot = Bot(token=TOKEN)
dp = Dispatcher()

# ============ –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ============

@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    logger.info(f"‚úÖ /start –æ—Ç {message.from_user.id}")
    await message.answer(
        "ü§ñ **JD7 System: Secure Launch**\n\n"
        "–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∑–∏–ª —Ç–æ–∫–µ–Ω –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã.\n"
        "–í—Å–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ã. üõ°"
    )

@dp.message(Command("status"))
async def cmd_status(message: types.Message):
    await message.answer("‚úÖ –ë–æ—Ç –æ–Ω–ª–∞–π–Ω. –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ.")

# ============ –ó–ê–ü–£–°–ö ============

async def main():
    logger.info("ü§ñ –ó–∞–ø—É—Å–∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏...")
    try:
        await dp.start_polling(bot)
    except Exception as e:
        logger.error(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
    finally:
        await bot.session.close()

if __name__ == "__main__":
    asyncio.run(main())
